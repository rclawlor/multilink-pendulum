function [Y,Xf,Af] = dynamics(X,~,~)
%DYNAMICS neural network simulation function.
%
% Auto-generated by MATLAB, 01-Mar-2023 23:01:12.
% 
% [Y] = dynamics(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 8xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3 4 5 6 7 9];
x1_step2.xoffset = [-7.64242377472062;-1.09975196930122;-1.44225246794691;-6.5900726564443;-0.320207495043137;-0.2591618320765;-0.240342256372144;-0.0998808075957488];
x1_step2.gain = [0.128046322606659;0.928787880383066;0.677987264182031;0.152279113461842;2.91266572033869;4.0514878113337;4.17369478405004;10.0099740850006];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.8922054218911958934;1.6013954025776842016;2.379099697089777532;0.91369440602043239252;-1.4827806052717709129;-2.2971755623219669573;2.0756984245129768141;-0.3895863545852381038;-1.949492521640125986;-0.48715843308682688084;1.010145940245327445;0.25896285749212066829;0.38060492984782867687;0.81817797872329034448;0.39474717400075243212;0.15270114742553755893;0.060454540046880250737;0.20330269510813625544;-0.13044542932624106357;0.63759543859119405251;-0.032410767789466922439;0.48927671746744183512;2.4735264078150138722;-0.85787196903434759232;2.8455081676593021456;1.2847180919681586708;-0.3923117712614454522;-3.0002726384254900793;2.8724081486142827302;1.9551388560728899524];
IW1_1 = [0.55277298340467040383 -0.35405239785538544783 1.9631843492096843207 -0.69692468882759506243 -1.5460988697859514573 -0.11909485381150015926 0.43941490126416726802 0.34378918000541291988;-2.0655775109389558075 0.084548558771374585086 -0.18258653712402081459 -0.018655215574897483083 -1.6010927443903970602 0.1174356035012207311 1.0842610561543182257 -0.084741981213561412556;-1.7898661012519470059 -1.0716989722789842521 0.24404073565764944354 -0.1891058303871538393 -0.55003013187902138892 0.9268608259477729705 0.019953103010745924795 0.42363623167356256882;-0.36564829105410961985 -0.24339299282280385528 0.13022380147755902025 0.1900925965539385365 -0.15540684326103818003 1.4419775475969482947 -1.2991087075234335479 0.57570339617174626223;1.9895466705761146731 1.147518461664936984 -1.3962794934875841779 -0.35576557872030151186 -2.7574387922989145316 -0.53968399431654778819 -0.51084195986815350565 0.038338491513606076655;1.5335636719258374239 0.70190833527324902885 -1.3020149937985552313 -2.1057649728394753907 0.80026325848436641319 -0.42832913165015795709 0.71795773349244784711 -0.81736333933098981319;-0.59985104207245931729 1.888816066639536384 0.14715523012124193114 0.50543446755062670928 0.39704922603833758821 -1.2821236891494083299 -1.5074481320043653376 1.6139700509935361872;0.52753455440295471401 -1.3463121430465689876 -1.7374484485310961457 0.613945182393215938 0.51506380218381087044 -0.032913812866439795535 -1.12388703013308211 0.15074586870614950507;1.6506319715852555419 -2.3760022159259857055 3.2290478132260913569 0.025499514446602589146 0.011472002028876861213 0.35113137308046765694 -0.13422287029096921507 -0.026629994087984606294;0.42569500791890541036 1.4914040908940922048 1.1328091403161506534 -0.28784008882917344607 -1.3382507621629986527 0.4837331811027959505 1.1525453799728011539 0.26699191673868960528;-0.50691488712627730262 0.47990168584222914205 -1.2450782048976527516 1.3862717195079821142 1.4839319027223378811 -0.13894896962990702094 -0.018862674300723969445 2.5383908885178230186;-1.5866217110709468496 0.54179672989672733596 -0.76857856236456534305 0.25112813807556688683 -0.49771185701166814619 0.79609605391175541911 -0.87865800360011425685 -1.5856226104175790148;-1.3286166500468885587 0.42466952555006365344 -1.9134870928205203189 -0.01343025337384136722 -0.746448737450930766 0.20520958921890444793 0.72153752526042924664 -0.23763349176310785693;-0.54509162540559441545 -0.20478127197280612815 0.33534030876437870283 -3.1440991003824998451 0.13426530499127131701 -0.53743109359356666666 0.90205848796119325606 0.38897329758693693913;2.6267845902587971807 0.11176330785524815625 -0.049664186916807170902 3.0128372444272910613 -0.6813862363333492711 -0.81830261785730851187 1.6448203048119134362 -0.45901106906147737252;0.2004646751815283845 -0.27278414513040710743 -0.6825455059422617099 -0.25264799509846508352 0.43581536271475579403 -0.48016163180519433329 1.8753679729725782899 0.0097368286638477036937;-0.16495452521276940394 -0.39585183078739649698 0.97279499697354099297 -0.4401506833263838514 0.019590997881308802597 0.43797812579485312368 -1.5676679545886971212 -2.0630166180087363692;-0.075346659984563704726 0.14956395324399435198 0.54008962561669371372 7.4555799065982872875 -0.054532984200384451712 -0.14759808948922015226 0.39061582790836180124 0.017600371806188196133;1.0009386247907579026 -3.3402570115483833924 0.37967553433357825732 -0.20262295421150236518 -1.0937733373452829255 -0.58178098783393272786 -1.3931120013687676717 -0.86538052789094344064;0.72616315447893753365 -1.0874802137912600308 -0.074762074211176671179 0.37092294033667461139 -0.34856386496720442869 -0.31930165786559838725 0.077073058827796470105 -0.52535499546477049115;-0.54441846430844886839 -0.011972525156218936579 0.047418853005770533748 -0.0016340876969081559629 0.00282913921220971816 -0.011383240864091367234 -0.0055113373035799995137 -0.0076538877541880157018;-0.080080139800775065884 0.41911038415949469771 0.66098974607985006013 1.8082816046527365739 0.10975787586156486586 -0.16127002752768332394 0.34153271626506609415 -0.17857345070756258654;-1.3820289102708924744 -0.77854206556816685225 -1.8906293624707732892 -0.89330018750773954039 1.1774960094574387082 0.11394211094193187894 -1.0342836069832570534 -0.68942131302653386626;-0.40257592073424763868 0.99973186598285013194 -0.30301897707930225412 0.11973302919753152362 0.75947044268608543405 0.54780061779372768438 -2.3736414023419878383 -0.44161931530890641273;-1.0089141859210120078 -0.84273166829803969335 -2.0523446522574526618 -0.56282451463634497468 -0.5076335995902985232 0.24132367850211944305 -0.35673764710216770979 -1.6135992894861075353;0.38547996303443005095 0.42178958128037907782 0.97778937650279895699 -0.42070447888557466198 -0.13216651120496650251 0.78947738982797843743 0.19198072189630430162 0.87721300131740376216;0.19524529304580140465 -0.12623268508948795597 0.21635826241391528657 5.064580623850144292 -0.38322416179100227129 0.14612636281736984811 0.049963910022037240355 -0.050493709249046475618;1.7950869713104677938 0.2396990666719230334 -1.4189610688624449963 -0.18867202621104467442 1.2054227971008217857 0.24039632576121777729 -1.0429790114957060432 -0.073580145237573044148;0.82434657495217811274 -0.28779569185703957057 -0.3340322722866501115 0.22870312083784161139 -1.3216128767068111571 0.16586504788293815471 -0.47918905233014869038 -1.4649490018433877214;-0.38684840442352691481 1.2838959479245215523 -0.062757304420871490303 -0.1259862789280691564 0.59875056643019997082 0.12666219994787802916 0.2053152296723799175 0.86999778584943354698];

% Layer 2
b2 = [0.028850027416109744194;0.16492327721844685096;-0.13272906227276626279;0.8731632793516266311;-0.52997782577132068749;0.21790591981157692025;0.098341182019301462414];
LW2_1 = [-0.005056605865768505105 0.012828053609161393922 -0.018279514345586663632 -0.0094476270303831769853 -0.0093660633017366191899 -0.0015643340214317434395 -0.0045254827511466751838 -0.02054976186878371136 0.0085145569190499051371 -0.0031193402787414266017 0.00011947941271998405578 -0.0084238543339564247309 -0.057604045242482609934 -0.010315550545889669992 0.00028257002329455942376 0.0029022130592723099918 0.00031717490704603087774 -0.0046653773654931852619 -0.0015819094024092281679 0.03056595630588851073 -1.844291669940708811 0.0018236152160681312704 0.041323705135311319947 -0.008655707390916464461 -0.0069036843950256452165 0.01425615857100920314 -0.0007660555675795405195 0.073424809726370596219 -0.014492684925633100151 -0.040574475341134778883;-0.018210862924393937667 -0.049100709677298806644 0.097255805691917912581 -0.097971963772297970818 0.037829425505668451413 0.014686790930123976018 -0.013823092027368276413 -0.22040840006417594665 0.038579632315146869526 0.14818649965248115175 -0.038126497832571118463 0.055458522796789540277 0.075330554589048345782 -0.045828108614063736703 0.035704141554123429436 -0.044370108317076550897 -0.10401718552836497489 -0.11794086449685504958 -0.13874006936844648918 -0.15498224597764936883 -0.42519728475860918415 0.16423531028678434174 0.084487510570075322058 0.21810536603674393619 0.13262052301115420661 -0.1614866237286079198 0.031765599803473251739 0.27413060986739601343 -0.24722291744615745857 0.51312981425070103292;-0.022008234283307552548 0.08037599641279817575 -0.17641537983475441553 0.14899158426310515901 -0.079147626405500132174 0.021653204207071612142 -0.019908977666103090665 -0.25222767283434643915 0.18499999893993793187 0.034365889626688378433 -0.0038127637004990635322 -0.040475678703181437734 -0.32982988794183648595 -0.058110778042100783014 -0.00085854566867677936659 -0.036853304522847449287 0.064994408869566894227 -0.023129359641529016051 -0.006789247213210926335 0.1290588235326658173 0.42649033912244949107 0.037236653703687477845 0.24834452030152681656 -0.16994114497963436206 -0.14615289122114089038 0.19867395963149989124 0.013411767378552964802 0.0052179497992173601989 0.040783622636510960535 -0.22973134597743227747;0.75150363222148430786 -1.7097766150804771801 -0.93958468720021870446 1.8318945732713547425 0.35357652380806914305 0.44307651332628655849 -0.17605663994874334866 -0.74488908637774431387 1.7795348351697937161 -1.2772124718453854442 -0.2599942601667303288 0.35636314318060474671 1.618161104905803338 1.7527210189382107508 0.54650217803710021691 -0.65317059612843209049 -0.48236588476475866782 -2.8391017594017373682 -0.26114733621716779144 -0.15452105084126049883 -1.0827224298420130566 1.6528228191840173 -1.389494651955831106 -0.74863471558405092487 1.106356732187214531 -1.2358723136492646422 2.2905026379887232224 -1.9790474875406913746 -1.1421690328275833082 1.0475454925428038244;-0.36173586108729638422 0.18978612403992664581 -0.24258100279291275325 -0.11793098714925448478 -0.17516314049238954076 -0.018808177311763183553 -0.036230930775635841745 0.12979635552807722298 0.22435398719411561719 -0.12668494629894302972 0.016769998944032079441 -0.14555413286566806774 -0.24756199960709904251 -0.10743268069492052652 0.034909374131447186429 0.21901870098569220513 0.063130319011482027847 0.31708413362521570278 0.034841016624980146454 -0.12507643977936605539 0.034995237299684026078 -0.33872879032714814374 0.29500169343674864653 0.38723004061081633953 -0.2214227343731264841 0.067043225963488661812 -0.2474313457665821836 -0.052230631063576671291 0.23298294946325995292 0.38849746630686571303;0.15225056589290661413 0.25212673340556157608 0.60432235934754707785 -0.34713481820576647108 -0.083800767683661264718 -0.035956259198222498275 0.029973747146647265749 0.10163200934325242186 -0.23601387144841498578 0.040743720483510999231 -0.052588098615576978068 -0.011532627686422040891 -0.24409154159606974432 -0.40924345055446820218 -0.09971651886153240496 0.024788902386136187073 -0.067438672127861698513 0.31588364750506681133 -0.074874507648887089761 0.13081012348051745953 -0.021552539510303288239 -0.066534824729638647467 0.24075148081391828381 0.12379328412802952097 -0.031512730619687609468 0.12404590059834989801 -0.49080454043533972008 0.56694748779128090188 -0.3169653330838053118 -0.093153601375766004189;-0.5195348277178091223 0.59567761771454952324 -0.35691857378069630213 -0.27441217666372574868 -0.13213591994591583623 0.098415420809157036497 -0.094332772886963817127 0.38158099092185721046 0.09252146527914037466 0.18191443069334103932 0.15993564836355589343 -0.34599888883571866538 -0.16050331774748760605 0.18704356758282350559 0.07109818826740076092 -0.099203187857146490902 0.19601752712217188068 -0.37682803679812509889 0.051441957877055223547 -0.22065129861460616723 0.80276581219095899389 0.24690870006842605133 0.53158442900373059636 -0.032727208548957220646 0.03628687637647123182 0.45594783673407301983 0.41998730481747065246 0.59406719773480509694 0.5221640066871419128 -0.94171573289129772988];

% Output 1
y1_step2.ymin = -1;
y1_step2.gain = [0.128046322606659;0.928787880383066;0.677987264182031;0.152279113461842;2.91266572033869;3.84661526835697;4.17369478405004];
y1_step2.xoffset = [-7.64242377472062;-1.09975196930122;-1.44225246794691;-6.5900726564443;-0.320207495043137;-0.2591618320765;-0.240342256372144];
y1_step1.xrows = 8;
y1_step1.keep = [1 2 3 4 5 6 7];
y1_step1.remove = 8;
y1_step1.constants = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    temp = mapminmax_reverse(a2,y1_step2);
    Y{1,ts} = removeconstantrows_reverse(temp,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

% Remove Constants Output Reverse-Processing Function
function x = removeconstantrows_reverse(y,settings)
  Q = size(y,2);
  x = nan(settings.xrows,Q,'like',y);
  x(settings.keep,:) = y;
  x(settings.remove,:) = repmat(settings.constants,1,Q);
end
